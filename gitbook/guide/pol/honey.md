---
icon: honey-pot
---

# PoL ë³´ì•ˆ ê°€ì´ë“œë¼ì¸: ì˜¤ë¼í´ ë° HONEY

<table><thead><tr><th width="591.7421875">ìœ„í˜‘</th><th align="center">ì˜í–¥ë„</th></tr></thead><tbody><tr><td><a data-mention href="honey.md#id-1">#id-1</a></td><td align="center"><code>Low</code></td></tr><tr><td><a data-mention href="honey.md#id-2-basket">#id-2-basket</a></td><td align="center"><code>Informational</code></td></tr><tr><td><a data-mention href="honey.md#id-3">#id-3</a></td><td align="center"><code>Informational</code></td></tr></tbody></table>

### ìœ„í˜‘ 1: ì™¸ë¶€ ì˜¤ë¼í´ ê°€ê²© ì¡°ì‘ ë° ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì˜¤ë¼í´ ë¡œì§

ì™¸ë¶€ ì˜¤ë¼í´ ê°€ê²© ì¡°ì‘ ë° ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì˜¤ë¼í´ ë¡œì§(ë‹¨ì¼ ì˜¤ë¼í´ ì˜ì¡´, ë¹„ëŒ€ì¹­ ì²˜ë¦¬ ë“±)ì„ í†µí•´ HONEY í† í°ì˜ ë¯¼íŒ…/ë¦¬ë”¤ ê³¼ì •ì—ì„œ í”„ë¡œí† ì½œ ì†ì‹¤ ë˜ëŠ” ì‚¬ìš©ì í”¼í•´ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

#### ì˜í–¥ë„

`Low`

ë‹¨ì¼ ì˜¤ë¼í´ì— ì˜ì¡´í•˜ê±°ë‚˜ ë””í˜ê¹…ì‹œì— ì‚¬ìš©ìì—ê²Œ ëª…í™•íˆ ì•ˆë‚´í•˜ì§€ ëª»í•  ê²½ìš° ì‚¬ìš©ì í”¼í•´ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìœ¼ë©° Flash Loanì„ í†µí•œ ê°€ê²© ì¡°ì‘ì— ì·¨ì•½í•  ê°€ëŠ¥ì„±ì´ ìˆì–´ `Low` ë¡œ í‰ê°€

#### ê°€ì´ë“œë¼ì¸

> * **3ê°œ ì´ìƒì˜ ë…ë¦½ì ì¸ ì˜¤ë¼í´ í”¼ë“œ ì¤‘ì•™ê°’ ë˜ëŠ” ê°€ì¤‘ í‰ê· ì„ ìµœì¢… ê°€ê²©ìœ¼ë¡œ ì‚¬ìš©**
> * **ì˜¤ë¼í´ í”„ë¡œì„¸ìŠ¤ ëª…ì‹œ(ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ)**
>   * **ì¶”ê°€:** ì‹ ê·œ ì˜¤ë¼í´ ì¶”ê°€ì‹œ ê±°ë²„ë„ŒìŠ¤ íˆ¬í‘œ ì ˆì°¨ í•„ìš”
>   * **ìˆ˜ì •:** ê¸°ì¡´ ì˜¤ë¼í´ì— ëŒ€í•œ ê°€ì¤‘ì¹˜ ì¡°ì • ì‹œ ìµœì†Œ 72ì‹œê°„ ì „ ì‚¬ì „ ê³µì§€ ë° ê±°ë²„ë„ŒìŠ¤ í”¼ë“œë°± ê¸°ê°„ í•„ìš”
>     * **72ì‹œê°„ ì‚¬ì „ê³µì§€:** ê±°ë²„ë„ŒìŠ¤ ì°¸ì—¬ì— ì¶©ë¶„í•œ ì‹œê°„ í™•ë³´
>   * **ì‚­ì œ:** ì˜¤ë¼í´ í”¼ë“œ ì œê±° ì‹œ ëŒ€ì²´ ì˜¤ë¼í´ í•„ìš”
>   * **ê¸´ê¸‰ ì¤‘ë‹¨:**&#x20;
>     * ê¶Œí•œì: ë©€í‹°ì‹œê·¸ ë˜ëŠ” ê±°ë²„ë„ŒìŠ¤ê°€ ì„ ì¶œí•œ ë§¤ë‹ˆì €ë¡œ ì œí•œ&#x20;
>     * ì¤‘ë‹¨ í›„ ì²˜ë¦¬: ë° 24ì‹œê°„ ë‚´ì— ì»¤ë®¤ë‹ˆí‹° ê³µì§€ ë° ë³µêµ¬ ê³„íš ì œì¶œ
>     * ë³µêµ¬ ì ˆì°¨: ê±°ë²„ë„ŒìŠ¤ ìŠ¹ì¸ í•„ìš”
> * **ì˜¤ë¼í´ ì´ìƒ ì‹œ ì²˜ë¦¬ ë¡œì§ êµ¬ì²´í™”**
>   * íŠ¹ì • ì˜¤ë¼í´ 30ì´ˆ ì´ìƒ ì—°ê²° ì§€ì—° ì‹œ í•´ë‹¹ ì˜¤ë¼í´ ì§‘ê³„ì—ì„œ ìë™ ì œì™¸
>   * ë‹¤ë¥¸ í”¼ë“œë“¤ì˜ ì¤‘ì•™ê°’ ëŒ€ë¹„ Â±0.1% ì´ˆê³¼ ì‹œ ê°€ì¤‘ì¹˜ 70% ê°ì†Œ, Â±0.15% ì´ˆê³¼ ì‹œ ìë™ ì œì™¸
>     * **Â±0.1% ê²½ê³ :** Honey í˜ê¹… í—ˆìš©ë²”ìœ„(0.2%)ì˜ 50% ìˆ˜ì¤€
>     * **Â±0.15% ì œì™¸:** Honey í˜ê¹… í—ˆìš©ë²”ìœ„ì˜ 75% ìˆ˜ì¤€
>   * ìµœì†Œ 3ê°œ ì´ìƒì˜ ì˜¤ë¼í´ì„ ì°¸ì¡°í•˜ì—¬ ê°€ê²© ê²°ì • ë° ê·¸ ë¯¸ë§Œì¼ ê²½ìš° ê±°ë˜ ì¼ì‹œ ì¤‘ë‹¨
>   * ë¹„í™œì„±í™”ëœ ì˜¤ë¼í´ ì¬í™œì„±í™” ì‹œ ê²€ì¦ í•„ìš”(ë¹„í™œì„±í™” ì‚¬ìœ , í™œì„±í™” ê°€ëŠ¥ ì—¬ë¶€)
>   * ì£¼ ì˜¤ë¼í´ ì´ìƒ ì‹œ ë³´ì¡° ì˜¤ë¼í´ë¡œ ìë™ ì „í™˜ ë©”ì»¤ë‹ˆì¦˜
> * **ì˜¤ë¼í´ ê°€ê²© ì‚¬ì „ ì„¤ì •ëœ ì„ê³„ì¹˜ ì´ìƒ ë³€ë™ì‹œ ì‚¬ìš©ìì—ê²Œ ê²½ê³ **
>   * **ì„ê³„ì¹˜ ì„¤ì •:** 1ë¶„ ê°€ê²© Â±0.1% ì´ˆê³¼ ì‹œ ì‚¬ìš©ì ê²½ê³ , Â±0.15% ì´ˆê³¼ ì‹œ Circuit Breaker
>   * **ì„ê³„ì¹˜ ë³€ê²½:** ì„ê³„ì¹˜ ë³€ê²½ ì‹œ ìµœì†Œ 72ì‹œê°„ ì „ ì‚¬ì „ ê³µì§€ ë° ê±°ë²„ë„ŒìŠ¤ í”¼ë“œë°± ê¸°ê°„ í•„ìš”
> * **ì˜¤ë¼í´ ê°„ì˜ ë¡œì§ ë¹„ëŒ€ì¹­ì„± í™•ì¸**
>   * "Spot ì˜¤ë¼í´ ê°€ê²©ì´ $1.00 ì´ˆê³¼ ì‹œ â†’ $1.00ìœ¼ë¡œ ì²˜ë¦¬"ê³¼ ê°™ì€ íŠ¹ì • ì˜¤ë¼í´ ë¡œì§ì´ ì•„ë‹Œ ì¼ë°˜í™” í•„ìš”
> * **ì¼ì • ê¸°ê°„ì˜ TWAP ê¸°ì¤€ ê°€ê²© ê²°ì •ì„ í†µí•´ ì‹¤ì‹œê°„ ì˜¤ë¼í´ ì¡°ì‘ ê³µê²© ì˜í–¥ ì™„í™”**
> * **HONEY í† í°ì˜ ì‹¬ê°í•œ í˜ê¹… ì´íƒˆì„ ì•…ìš©í•œ ê²½ì œì  ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë¹„ì •ìƒì ì¸ ê±°ë˜ëŸ‰ ê¸‰ì¦ ë˜ëŠ” ë°˜ë³µì ì¸ ê³µê²© íŒ¨í„´ ê°ì§€ ì‹œ ê±°ë˜ ì§€ì—°ì´ë‚˜ ì¶”ê°€ ê²€ì¦ì„ ìš”êµ¬í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ ë„ì… ê³ ë ¤**

#### Best Practice

&#x20;[`HoneyFactory.sol`](https://github.com/wiimdy/bearmoon/blob/c5ff9117fc7b326375881f9061cbf77e1ab18543/Core/src/honey/HoneyFactory.sol#L569-L578)&#x20;

```solidity
uint256 private constant DEFAULT_PEG_OFFSET = 0.002e18;
uint256 private constant MAX_PEG_OFFSET = 0.02e18;

// í˜ê¹… ë¡œì§ í™•ì¸
function isPegged(address asset) public view returns (bool) {
    if (!priceOracle.priceAvailable(asset)) return false;
    IPriceOracle.Data memory data = priceOracle.getPriceUnsafe(asset);
    if (data.publishTime < block.timestamp - priceFeedMaxDelay) return false;
    return (1e18 - lowerPegOffsets[asset] <= data.price) && (data.price <= 1e18 + upperPegOffsets[asset]);
}
```

[`HoneyFactory.sol`](https://github.com/wiimdy/bearmoon/blob/c5ff9117fc7b326375881f9061cbf77e1ab18543/Core/src/honey/HoneyFactory.sol#L163-L170)&#x20;

```solidity
// ì˜¤ë¼í´ì—ì„œ ìµœì‹  ê°€ê²©ì„ ê°€ì ¸ì˜¤ë„ë¡ ì„¤ê³„
function setMaxFeedDelay(uint256 maxTolerance) external {
    _checkRole(MANAGER_ROLE);
    if (maxTolerance > MAX_PRICE_FEED_DELAY_TOLERANCE) {
        AmountOutOfRange.selector.revertWith();
    }
    priceFeedMaxDelay = maxTolerance;
    emit MaxFeedDelaySet(maxTolerance);
}
```

`ì»¤ìŠ¤í…€ ì½”ë“œ`&#x20;

```solidity
contract EnhancedMultiOracleSystem {
    struct OracleData {
        address oracle;
        uint256 weight;
        bool isActive;
        bool isEmergencyPaused;
    }

// ê°€ì´ë“œë¼ì¸: ê¸´ê¸‰ ì¤‘ë‹¨ ê¸°ëŠ¥
    function emergencyPause(address asset) external onlyManager {
        emergencyPaused[asset] = true;
    }
    
// ê°€ì´ë“œë¼ì¸: í¸ì°¨ ê²€ì‚¬ + ê°€ì¤‘í‰ê·  ê³„ì‚°
    function getAggregatedPrice(address asset) external view returns (uint256) {
        require(!emergencyPaused[asset], "Emergency paused");
        
        OracleData[] memory oracles = assetOracles[asset];
        require(oracles.length >= MIN_ORACLES, "Insufficient oracles");
        
        uint256[] memory prices = new uint256[](oracles.length);
        uint256[] memory weights = new uint256[](oracles.length);
        uint256 validCount = 0;
        
        // 1. ê°€ê²© ìˆ˜ì§‘
        for (uint256 i = 0; i < oracles.length; i++) {
            if (oracles[i].isActive && !oracles[i].isEmergencyPaused) {
                try IPriceOracle(oracles[i].oracle).getPrice(asset) returns (uint256 price) {
                    prices[validCount] = price;
                    weights[validCount] = oracles[i].weight;
                    validCount++;
                } catch {}
            }
        }
        
        require(validCount >= MIN_ORACLES, "Not enough valid oracles");
        
        // 2. ì¤‘ì•™ê°’ ê³„ì‚° ë° í¸ì°¨ ê²€ì‚¬
        uint256 median = _calculateMedian(prices, validCount);
        uint256 totalWeight = 0;
        uint256 weightedSum = 0;
        
        for (uint256 i = 0; i < validCount; i++) {
            uint256 deviation = _calculateDeviation(prices[i], median);
            
            // 0.15% ì´ˆê³¼ í¸ì°¨ ì‹œ ì œì™¸
            if (deviation <= DEVIATION_THRESHOLD) {
                weightedSum += prices[i] * weights[i];
                totalWeight += weights[i];
            }
        }
        
        require(totalWeight > 0, "No valid prices after filtering");
        
        return weightedSum / totalWeight;
    }

}
```

***

### ìœ„í˜‘ 2: ì§€ë‚˜ì¹˜ê²Œ ë¯¼ê°í•œ ë””í˜ê¹… ê¸°ì¤€ ë° Basket ëª¨ë“œ í™œì„±í™” ì¡°ê±´ ì•…ìš©

ë§¤ìš° ë‚®ì€ ìˆ˜ì¤€ì˜ ê°€ê²© ë³€ë™ì—ë„ ë””í˜ê¹…ìœ¼ë¡œ ê°„ì£¼í•˜ëŠ” ê¸°ì¤€ì€ ì‚¬ì†Œí•œ ì‹œì¥ ë³€ë™ì„±ì—ë„ Basket ëª¨ë“œë¥¼ ë¹ˆë²ˆí•˜ê²Œ í™œì„±í™”ì‹œì¼œ ì‚¬ìš©ì ê²½í—˜ì„ ì €í•´í•  ìˆ˜ ìˆë‹¤.&#x20;

ë˜í•œ, ê³µê²©ìê°€ ì˜ë„ì ìœ¼ë¡œ íŠ¹ì • êµ¬ì„± ìŠ¤í…Œì´ë¸” ì½”ì¸ì˜ ë¯¸ì„¸í•œ ë””í˜ê¹…ì„ ìœ ë„í•˜ì—¬ Basket ëª¨ë“œë¥¼ ë°œë™ì‹œí‚¤ê³  ì‚¬ìš©ìê°€ ì˜ˆì¸¡í•˜ì§€ ëª»í•œ ìì‚° êµ¬ì„± ë¹„ìœ¨ë¡œ ë¯¼íŒ…ì´ë‚˜ ë¦¬ë”¤í•˜ë„ë¡ ìœ ë„í•  ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•œë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ë³µìˆ˜ì˜ êµ¬ì„± ìŠ¤í…Œì´ë¸” ì½”ì¸ ì¤‘ ì¼ë¶€ë§Œ ì†Œí­ ë””í˜ê¹…ëœ ê²½ìš°ì—ë„ Basket ëª¨ë“œì— ì˜í•œ ìƒí™˜ì´ ê°•ì œëœë‹¤ë©´ ì‚¬ìš©ìëŠ” ì •ìƒ í˜ê¹… ìƒíƒœì¸ ìì‚°ìœ¼ë¡œë§Œ ë°›ê¸°ë¥¼ ì›í–ˆìŒì—ë„ ì›ì¹˜ ì•Šì€ ìì‚°ì„ ìˆ˜ë ¹í•˜ê²Œ ë  ìœ„í—˜ì´ ë°œìƒí•œë‹¤.

#### ì˜í–¥ë„

`Informational`

ë””í˜ê¹… ê¸°ì¤€ì¹˜ëŠ” í”„ë¡œí† ì½œì´ ê²°ì •í•˜ëŠ” ê²ƒì´ë‚˜ ë¯¼íŒ…ê³¼ ë¦¬ë”¤ ë¡œì§ì˜ basket ëª¨ë“œê°€ ê°ê° ë”°ë¡œ ë™ì‘í•œë‹¤ë©´ í˜¼ë€ì„ ê°€ì¤‘ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, ì„¸ë¶„í™”ëœ basket ëª¨ë“œë¥¼ í†µí•´ ì‚¬ìš©ì í¸ì˜ì„±ì„ ì˜¬ë¦¬ëŠ” í¸ì„ ê¶Œê³ í•˜ê¸° ìœ„í•´ `Informational` ë¡œ í‰ê°€

#### ê°€ì´ë“œë¼ì¸

> * **ë¯¼ê°ë„ ì¡°ì • ê¸°ì¤€:** ë¯¼íŒ…ê³¼ ë¦¬ë”¤ì‹œì— ê°ê° ë”°ë¡œ basket ëª¨ë“œê°€ ë”°ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ [ê°€ê²© ë³€ë™ë¥ ](../../undefined.md#id-0.1-0.2-0.5-0.1-0.2-honey-default_peg_offset-0.5-chainlink) ì°¨ì´ë³„ë¡œ basket ëª¨ë“œì˜ ë‹¨ê³„ë¥¼ ë‚˜ëˆ„ì–´ ì ìš©
>   * ê²½ê³  ë‹¨ê³„ (0.1%): 1ë¶„ ì§€ì† ì‹œ ì‚¬ìš©ì ì•Œë¦¼
>   * (ì¼ì‹œì  ë””í˜ê¹…) ì œí•œ ë‹¨ê³„ (0.2%): 1ë¶„ ì§€ì† ì‹œ í•´ë‹¹ ìì‚° ë¯¼íŒ… ì œí•œ ë° êµí™˜ë¹„ ì¡°ì •
>   * (ë””í˜ê¹…) Basket ë‹¨ê³„ (0.5%): 1ë¶„ ì§€ì† ì‹œ ì¦‰ì‹œ Basket ëª¨ë“œ í™œì„±í™”
> * **Basket ëª¨ë“œ í™œì„±í™”ëŠ” ìµœí›„ì˜ ì•ˆì •ì„± ìœ ì§€ ìˆ˜ë‹¨ìœ¼ë¡œ ê³ ë ¤í•˜ë©° í˜ê¹… ìì‚°ì˜ ì•ˆì •ì„± íšŒë³µ ì‹œ ìë™ í•´ì œ**
>   * **ì•ˆì •ì„± íšŒë³µ:** [1ì‹œê°„ ì—°ì† ì•ˆì •(0.2% ë¯¸ë§Œ)](../../undefined.md#id-1-2-1-180) ì‹œ ìë™ìœ¼ë¡œ ì •ìƒ ëª¨ë“œ ë³µê·€

#### Best Practice

[`HoneyFactory.sol`](https://github.com/wiimdy/bearmoon/blob/c5ff9117fc7b326375881f9061cbf77e1ab18543/Core/src/honey/HoneyFactory.sol#L526-L553)&#x20;

<pre class="language-solidity"><code class="lang-solidity">function isBasketModeEnabled(bool isMint) public view returns (bool) {
    if (forcedBasketMode) return true;
    
    for (uint256 i = 0; i &#x3C; registeredAssets.length; i++) {
        address asset = registeredAssets[i];
        if (isBadCollateralAsset[asset] || vaults[asset].paused()) continue;
        if (isMint &#x26;&#x26; !<a data-footnote-ref href="#user-content-fn-1">isPegged</a>(asset)) return true;
    }
    return false;
}
</code></pre>

`ì»¤ìŠ¤í…€ ì½”ë“œ`&#x20;

```solidity
contract StabilityRecovery {
    struct RecoveryState {
        uint256 recoveryStartTime;
        uint256 stableCount;          // ì—°ì† ì•ˆì • ì¹´ìš´íŠ¸
        bool isRecovering;
    }
    
    uint256 public constant RECOVERY_CONFIRMATION_PERIOD = 30 minutes;  // 30ë¶„ ì—°ì† ì•ˆì •
    uint256 public constant STABILITY_CHECK_INTERVAL = 1 minutes;       // 1ë¶„ë§ˆë‹¤ ì²´í¬
    
    // ğŸ”„ ìë™ íšŒë³µ ë¡œì§
    function checkAutoRecovery(address asset) external returns (bool) {
        if (isPriceStable(asset)) {
            if (!recoveryStates[asset].isRecovering) {
                // íšŒë³µ ì‹œì‘
                recoveryStates[asset].recoveryStartTime = block.timestamp;
                recoveryStates[asset].isRecovering = true;
                recoveryStates[asset].stableCount = 1;
            } else {
                // ì—°ì† ì•ˆì •ì„± ì¦ê°€
                recoveryStates[asset].stableCount++;
                
                // 30ë¶„ ì—°ì† ì•ˆì • ì‹œ ìë™ í•´ì œ
                if (block.timestamp >= recoveryStates[asset].recoveryStartTime + RECOVERY_CONFIRMATION_PERIOD) {
                    _resetToNormalMode(asset);
                    return true;
                }
            }
        } else {
            // ë¶ˆì•ˆì • ê°ì§€ ì‹œ íšŒë³µ ìƒíƒœ ë¦¬ì…‹
            _resetRecoveryState(asset);
        }
        return false;
    }
}
```

***

### ìœ„í˜‘ 3: ë””í˜ê¹…ëœ ìì‚°ì˜ ìƒí™˜ì‹œ ê°€ì¹˜ í‰ê°€ ë° ì‚¬ìš©ì ê³ ì§€ ë¶ˆí™•ì‹¤ì„±

'ë””í˜ê¹…ëœ ìì‚°ì´ ì–´ë–¤ ê°€ê²©ìœ¼ë¡œ í‰ê°€ë˜ì–´ ì‚¬ìš©ìì—ê²Œ ë°˜í™˜ë˜ëŠ”ì§€', 'ì´ ê³¼ì •ì—ì„œ ì‚¬ìš©ìê°€ ì–´ëŠ ì •ë„ì˜ ì ì¬ì  ì†ì‹¤ì„ ê°ìˆ˜í•´ì•¼ í•˜ëŠ”ì§€'ì— ëŒ€í•œ ê¸°ì¤€ê³¼ ê³ ì§€ê°€ ëª…í™•í•˜ì§€ ì•Šë‹¤ë©´ ì‚¬ìš©ìëŠ” basket ëª¨ë“œ ìƒíƒœì—ì„œ ë°›ì„ í† í°ì˜ ê°€ì¹˜ë¥¼ ì •í™•í•˜ê²Œ í‰ê°€í•  ìˆ˜ ì—†ë‹¤.

#### ì˜í–¥ë„

`Informational`

ì‚¬ìš©ì í¸ì˜ì„± ì¸¡ë©´ì—ì„œì˜ ìœ„í˜‘ì´ê¸°ì—`Informational` ë¡œ í‰ê°€

#### ê°€ì´ë“œë¼ì¸

> * **Basket ëª¨ë“œê°€ í™œì„±í™” ëœ ìƒíƒœì—ì„œ ìƒí™˜ ì‹œ ë””í˜ê¹…ëœ ìì‚°ì€** [**3ê°œ ì´ìƒì˜ ì˜¤ë¼í´**](../../undefined.md#chainlink-3)**ì„ ì°¸ì¡°í•˜ì—¬ ìì‚°ì˜ ê°€ì¹˜ë¥¼ í‰ê°€**
>   * ì´ ê³¼ì •ì—ì„œ í™œì„±í™”ëœ ì˜¤ë¼í´ë§Œì„ ì°¸ì¡°(ë¹„í™œì„±í™”, ê¸´ê¸‰ì¤‘ë‹¨ ì˜¤ë¼í´ ì°¸ì¡° ê¸ˆì§€)
> * **ì‚¬ìš©ìì—ê²Œ ìƒí™˜ ê³¼ì •ì—ì„œ ë””í˜ê¹… ìì‚°ì´ í¬í•¨ë  ìˆ˜ ìˆë‹¤ëŠ” ì , ë””í˜ê¹… ìì‚°ì˜ í‰ê°€ ê¸°ì¤€, ê·¸ë¦¬ê³  ì´ë¡œ ì¸í•œ ì ì¬ì  ì†ì‹¤ ê°€ëŠ¥ì„±ì— ëŒ€í•´ ëª…í™•í•˜ê³  ì‰½ê²Œ ê³ ì§€í•˜ëŠ” ì ˆì°¨ í•„ìš”**
>   * ë””í˜ê¹…ëœ ìì‚°ìœ¼ë¡œ ì¸í•œ ì˜ˆìƒ ì†ì‹¤ì„ ì–´ë–»ê²Œ ê³„ì‚°í•˜ëŠ”ì§€ì— ëŒ€í•œ [ìˆ˜ì‹ ê¸°ë°˜ ì„¤ëª…](../../undefined.md#calculateloss-acknowledgerisk)
> * **í•„ìš”ì‹œ í”„ë¡œí† ì½œ ì°¨ì›ì—ì„œ ë””í˜ê¹…ëœ ìì‚°ìœ¼ë¡œ ì¸í•œ ê¸‰ê²©í•œ ì†ì‹¤ ìœ„í—˜ì„ ì¼ë¶€ ì™„í™”í•  ìˆ˜ ìˆëŠ” ë‚´ë¶€ ì¤€ë¹„ê¸ˆ ìš´ì˜ ê³ ë ¤**
>   * ì¤€ë¹„ê¸ˆ êµ¬ì„±ì€ ìƒí™˜ê³¼ì •ì—ì„œ ë°œìƒí•œ ìˆ˜ìˆ˜ë£Œì˜ ì¼ë¶€ë¥¼ í™œìš©í•´ì„œ ë‚´ë¶€ ì¤€ë¹„ê¸ˆìœ¼ë¡œ ìš´ì˜
>   * ì¤€ë¹„ê¸ˆì€ basket ëª¨ë“œ í™œì„±í™” ì‹œì— í•œì •í•˜ì—¬ í™œì„±í™”í•˜ë©° ì‚¬ìš©ì ì†ì‹¤ì„ ìµœì†Œí™”í•˜ëŠ”ë° ì‚¬ìš©

#### Best Practice

[`HoneyFactory.sol`](https://github.com/wiimdy/bearmoon/blob/c5ff9117fc7b326375881f9061cbf77e1ab18543/Core/src/honey/HoneyFactory.sol#L368-L418)&#x20;

```solidity
function redeem(address asset, uint256 honeyAmount, address receiver, bool expectBasketMode) 
    external whenNotPaused returns (uint256 redeemedAssets) {
    _checkRegisteredAsset(asset);
    
    bool basketMode = isBasketModeEnabled(false);
    if (basketMode != expectBasketMode) {
        UnexpectedBasketModeStatus.selector.revertWith();
    }
    
    if (!basketMode) {
        _checkGoodCollateralAsset(asset);
        redeemedAssets = _redeem(asset, honeyAmount, receiver);
    } else {
        uint256[] memory weights = _getWeights(false, true);
        // Basket ëª¨ë“œ ìƒí™˜ ë¡œì§
    }
}
```

`ì»¤ìŠ¤í…€ ì½”ë“œ`&#x20;

<pre class="language-solidity"><code class="lang-solidity">// ìƒí™˜ ì „ ë””í˜ê¹…ëœ ìì‚° í¬í•¨ ì—¬ë¶€ì™€ ì˜ˆìƒ ì†ì‹¤ì„ ë¯¸ë¦¬ ê³„ì‚°í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ê²½ê³ í•˜ê³  ìœ„í—˜ ì¸ì§€ í™•ì¸ì„ ë°›ëŠ” ì‚¬ì „ ê³ ì§€ ì‹œìŠ¤í…œ

contract RedeemWarningSystem {
    struct RedeemWarning {
        bool hasDepeggedAssets;
        uint256 estimatedLoss;
        address[] depeggedAssets;
    }
    
    function getRedeemWarning(uint256 honeyAmount) external view returns (RedeemWarning memory) {
        address[] memory assets = getRegisteredAssets();
        uint256 depeggedCount = 0;
        uint256 totalLoss = 0;
        
        for (uint256 i = 0; i &#x3C; assets.length; i++) {
            if (!isPegged(assets[i])) {
                depeggedCount++;
                totalLoss += <a data-footnote-ref href="#user-content-fn-2">calculateLoss</a>(assets[i], honeyAmount);
            }
        }
        
        return RedeemWarning(depeggedCount > 0, totalLoss, assets);
    }
    
    function acknowledgeRisk(uint256 honeyAmount) external {
        // ì‚¬ìš©ì ìœ„í—˜ ì¸ì§€ í™•ì¸
        emit RiskAcknowledged(msg.sender, honeyAmount);
    }
} 

// calculateLoss() ì°¸ì¡°
function calculateLoss(address asset, uint256 honeyAmount) internal view returns (uint256) {
    // 1. í˜„ì¬ ì‹œì¥ ê°€ê²© ì¡°íšŒ (ë‹¤ì¤‘ ì˜¤ë¼í´)
    uint256 currentPrice = getAggregatedPrice(asset); // ì˜ˆ: 0.85e18 (15% ë””í˜ê¹…)
    uint256 pegPrice = 1e18; // $1.00
    
    // 2. ë””í˜ê¹… ìƒí™©ì—ì„œë§Œ ì†ì‹¤ ê³„ì‚°
    if (currentPrice >= pegPrice) return 0;
    
    // 3. ì‚¬ìš©ìê°€ ë°›ì„ í•´ë‹¹ ìì‚°ì˜ ì–‘ ê³„ì‚°
    uint256[] memory weights = getWeights();
    uint256 assetIndex = getAssetIndex(asset);
    uint256 userAssetAmount = honeyAmount * weights[assetIndex] / 1e18;
    
    // 4. ë””í˜ê¹…ìœ¼ë¡œ ì¸í•œ ì†ì‹¤ ê³„ì‚°
    uint256 depegRatio = (pegPrice - currentPrice) * 1e18 / pegPrice;
    uint256 assetValueAtPeg = userAssetAmount * pegPrice / 1e18;
    uint256 loss = assetValueAtPeg * depegRatio / 1e18;
    
    return loss;
}
    // calculateLoss() ê³„ì‚° ì˜ˆì‹œ:
    
    // ì…ë ¥ê°’:
    // honeyAmount: 1000 HONEY
    // USDC ê°€ê²©: $0.85 (15% ë””í˜ê¹…)
    // USDC ê°€ì¤‘ì¹˜: 30%
    
    // ê³„ì‚° ê³¼ì •:
    // userAssetAmount = 1000 Ã— 0.3 = 300 USDC
    // depegRatio = (1.00 - 0.85) / 1.00 = 0.15 (15%)
    // assetValueAtPeg = 300 Ã— $1.00 = $300
    // loss = $300 Ã— 0.15 = $45 
    
    // ê²°ê³¼: 
    // ì‚¬ìš©ìëŠ” USDC ë””í˜ê¹…ìœ¼ë¡œ $45 ì†ì‹¤ ì˜ˆìƒ
</code></pre>

\


[^1]: ë‹¤ì¤‘ ì˜¤ë¼í´ ì§‘ê³„ì™€ í™œì„±í™”ëœ ì˜¤ë¼í´ë§Œ ì°¸ì¡°í•˜ëŠ” í˜ê¹… ìƒíƒœ ê²€ì¦ ë¡œì§, ì‹ ë¢°ì„± ìˆëŠ” ê°€ê²© íŒë‹¨

[^2]: ë ˆí¼ëŸ°ìŠ¤ \[26] calculateLoss ìˆ˜ì‹ ë ˆí¼ëŸ°ìŠ¤\
    ë””í˜ê¹… ë¹„ìœ¨ Ã— ìì‚° ê°€ì¹˜ë¡œ ì†ì‹¤ ê³„ì‚°, ì‚¬ìš©ì ìœ„í—˜ ê³ ì§€ì™€ acknowledgeRisk í™•ì¸ í•„ìˆ˜
