---
description: >-
  PoL 메커니즘의 핵심 구성요소들(RewardVault, Validator Operator, Incentive Distributor,
  BlockRewardsController, Honey 관련 컨트랙트 등)은 시스템 전체의 안정성과 직결됩니다.  이들 컨트랙트에서 발생할 수
  있는 주요 위협과 보안 가이드라인은 다음과 같습니다.
---

# 3.1. 코어 컨트랙트

#### PoL 보안 가이드라인: 보상 분배 시스템 <a href="#pol" id="pol"></a>

T-1. | 위협 |

보상 분배 로직 오류로 인한 특정 사용자에게 과도한 보상 지급 또는 보상 누락

\| 가이드라인 |

1\. 95% 코드 커버리지, Fuzz 테스트, 100명 이상 사용자 시뮬레이션 등 구체적 수치 제시\
2\. Python/JavaScript 기반 오프체인 검증 시스템 구현 방안

\| Best Practice |\
contracts/src/pol/rewards/StakingRewards.sol:\_notifyRewardAmount

* 보상이 추가 될 경우 rewardRate 계산

T-2. | 위협 |

잘못된 접근 제어로 인한 권한 없는 보상 인출 또는 조작

\| 가이드라인 |\
1\. 각 함수 및 중요 데이터에 대해 명확한 역할(Owner, Admin, User 등)을 정의, 역할에 따른 접근 권한을 엄격히 부여\
2\. onlyOwner, onlyRole 등의 modifier를 명확히 사용\
3\. 관리자 활동(권한 변경, 중요 함수 호출 등)에 대한 이벤트 로깅

\| Best Practice |\
contracts/src/pol/rewards/StakingRewards.sol:addIncentive

* incentive rate 변동은 manager 권한만 가능

contracts/src/pol/rewards/RewardVault.sol:getReward

* reward 수령은 사용자 혹은 사용자가 설정한 operator만 실행 가능

T-3. | 위협 |

재진입(Re-entrancy) 공격을 통해 보상 중복 청구

\| 가이드라인 |\
1\. 체크-효과-상호작용(Checks-Effects-Interactions) 패턴을 준수\
2\. nonReentrant 가드 사용.

\| Best Practice |\
contracts/src/pol/rewards/RewardVault.sol:getReward

* nonReentrant 가드 사용
* unclaimed된 보상을 초기화 하고 trasnfer 진행

T-4. | 위협 |

Operator들이 담합하여 특정 reward vault에만 BGT 보상을 집중, 유동성 쏠림 및 타 프로토콜 유동성 고갈

\| 가이드라인 |\
1\. 여러 종류 Reward vault에게 나눠 주도록 강제(실제 Berachain 정책 반영)\
2\. Operator/Validator reward allocation 변경 시 투명한 로그 기록 및 모니터링\
3\. 담합 의심 시 거버넌스/커뮤니티 신고 및 감사 프로세스 마련\
4\. vault별 TVL, APR, 유동성 집중도 실시간 대시보드 제공

\| Best Practice |

contracts/src/pol/rewards/Berachef.sol: \_validateWeights

* 중복 vault 체크, reward vault당 최대 30% 까지 할당 가능

T-5. | 위협 |

보상 분배 계산 과정 중 나눗셈 연산 정밀도 오류 발생 시 사용자 보상 미세 손실 누적 가능

\| 발생 위치 | RewardVault

\| 가이드라인 |\
1\. 보상 수령 대상 및 금액의 정확성을 교차 검증하는 로직 추가\
2\. 최소 수량 or 최대 수량 설정으로 나눗셈 연산 오류 방지\
3\. 사용자 유리한 반올림 정책

\| Best Practice |

T-6. | 위협 |

Reward Vault Factory Owner가 악의적인 distributor 생성 시 사용자 보상 시스템 문제 발생

\| 가이드라인 |\
1\. 악의적인 distributor 변경이 즉각 반영되는 것을 방지하기 위한 Timelock 등의 추가 보안 절차 반영 필요\
2\. 변경시 다중 서명 거버넌스 (3명 중 2/3 승인) 필요

T-7. | 위협 |

Incentive token이 고갈된 뒤에 추가 공급을 하지 않으면 Validator들이 지급하는 Boost Reward 감소

\| 가이드라인 |\
1\. RewardVault 내의 Incentive token 최소 보유량을 제한\
2\. Validator의 경우 BGT를 분배할 reward vault를 선택할때 Incentive token이 충분히 남아있는지 확인\
3\. Reward vault에 incentive가 얼마나 남았는지 확인하는 대시보드 제작

\| Best Practice |

T-8. | 위협 |

Incentive token가 고갈 된 후 Incentive rate를 낮춰 해당 vault를 선택한 validator들의 Boost APR 감소

\| 가이드라인 |\
1\. Reward Vault의 Incentive rate 변동 시 delay 설정\
2\. 사용자에게 incentive rate 변화 알릴 수단 추가

\| Best Practice |

T-9. | 위협 |

보상 분배 중 모든 LP token을 withdraw하여 잔고를 0으로 만들면 해당 보상 증발

\| 가이드라인 |\
1\. 새로운 reward vault를 만들 때는 소량의 초기 LP token을 운영할 주체가 예치(LP가 0 이 되지 않도록)\
\| Best Practice |

T-10. | 위협 |

정상적인 Incentive token 제거에 따른 보상 중단

\| 가이드라인 |

1\. removeIncentiveToken 함수의 호출 조건에 제한 로직 추가 (예: 해당 토큰이 현재 활성 보상 분배 중인 경우 제거 불가)\
2\. Incentive Token 제거 또는 교체는 거버넌스 승인을 요구하도록 설계\
3\. Incentive Token 제거 전, 해당 Vault의 남은 분배량 및 종료 일정 공지\
4\. 토큰 제거 시 이벤트 로그 기록 필수 및 대시보드 상 실시간 반영\
5\. Vault의 보상 구조 변경(토큰 추가/제거)은 사용자에게 사전 고지 및 명확한 UI 표시\
6\. 보상 토큰 변경 이력은 감사 로그(audit trail) 로 저장, 분기별 커뮤니티 감사 진행

\| Best Practice |

T-11. | 위협 |

claimFees() 프론트러닝에 따른 사용자의 수수료 보상 왜곡

\| 가이드라인 |

1\. claimFees() 호출 시 프론트러닝 방지를 위해 수수료 계산 기준이 되는 블록 넘버/타임스탬프를 내부 저장하고 호출자 기준으로 고정하여 외부 간섭 방지 or 클레임 대상 사용자 주소 명시 필드 활용

2\. $HONEY 등 Fee Token 잔고가 급변할 경우 이상 징후 탐지 및 임시 정지 로직(safeguard) 활성화

3\. 수수료 누적/청구/소진 과정은 이벤트 로그를 통한 추적이 가능해야 하며, 이상 징후 발생 시 자동 경고를 발생시키는 보상 모니터링 시스템 구축

4\. 클레임 가능한 수수료 토큰 종류는 허용된 화이트리스트기반으로 제한

\| Best Practice |

T-12. | 위협 |

dApp 프로토콜의 Fee Token 송금 누락에 따른 사용자 보상 실패

\| 가이드라인 |

1\. FeeCollector와 dApp 간 수수료 정산 상태(누적/미정산)를 주기적으로 확인하는 오프체인 모니터링 시스템 도입

2\. 일정 기간 동안 수수료 송금이 누락된 dApp은 해당 vualt의 인센티브 대상에서 제외하거나 거버넌스를 통해 보상 삭감/정지 등의 제재가 가능하도록 설계

3\. claimFees() 호출 시, payoutAmount가 200 HONEY(=1%) 이하일 경우 명확한 revert 사유 및 UI 피드백 제공

\| Best Practice |

\| 위협 |\
보상 관련 취약점

\| 가이드라인 |

1. 정밀한 보상 계산:

* 스테이킹 시점부터 현재까지 정확한 시간 계산
* 복리 계산 시 정밀도 손실 방지 (최소 18자리 고정소수점)
* 보상률 변경 시점 정확한 반영

2. 보상 보안 및 관리:

* 개별 사용자 보상 별도 추적 및 관리
* 보상 클레임 시 사용자 신원 엄격 확인
* 대량 보상 인출 시 다중 서명 필수

3. 보상 풀 관리:

* 보상 토큰 잔량 실시간 추적 및 고갈 예상 시점 계산
* 자동 보충 시스템 및 대체 보상 방안
* 스테이킹 상태 변경 시 즉시 보상 계산 및 배치 처리
